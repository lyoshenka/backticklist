<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Backtick.io Custom Commands</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.4.1/pure-min.css">
    <link rel="stylesheet" href="/style.css">
    <style type="text/css">
      ul,li { list-style-type: none; }
    </style>
  </head>
  <body>
    <div class="pure-u-7-8">
      <h1>Backtick.io Custom Commands</h1>
      <table id="list" class="pure-table pure-table-striped">
        <thead>
          <th>Name</th>
          <th>Description</th>
          <th>URL</th>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://www.datatables.net/release-datatables/media/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var forksUrl = 'https://api.github.com/gists/6859173/forks',
            auth = '?access_token=78d729db8f64c986906175d177dbcb33e024d7ba',
            forkTemplate = '<h3><a href="{{url}}">{{name}}</a></h3>{{description}}',
            $list = $('#list');

        $list.dataTable({
          iDisplayLength: 20,
          bLengthChange: false,
          bInfo: false
        });

        var doFork = function(forkUrl) {
          $.getJSON(forkUrl + auth)
            .done(function(fork) {
              var desc = JSON.parse(fork.files['command.json'].content);
              if (desc.name == 'Example Command') {
                return;
              }
              $list.dataTable().fnAddData([
                desc.name,
                desc.description,
                fork.html_url
              ]);
            })
            .fail(function(data) {
              console.log(data.responseJSON.message);
            });
        };


        $.getJSON(forksUrl + auth)
          .done(function(data) {
            $.each(data, function(index, fork) {
              doFork(fork.url);
            })
          })
          .fail(function(data) {
            alert(data.responseJSON.message);
          });
      });
    </script>
  </body>
</html>